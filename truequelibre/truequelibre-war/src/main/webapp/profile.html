<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Hercules">
    <meta name="keyword" content="Truequelibre">
    <link rel="shortcut icon" href="images/favicon.png">

    <title>Perfil</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="assets/gritter/css/jquery.gritter.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
	<script src="js/truequelibre/truequelibre.js" type="text/javascript"></script>  
  <section id="container" class="">
      <!--header start-->
      <header class="header white-bg">
          <div class="sidebar-toggle-box">
              <div data-original-title="Toggle Navigation" data-placement="right" class="icon-reorder tooltips"></div>
          </div>
          <!--logo start-->
          <a href="index.html" class="logo" ><img src="images/logo-truequelibre.png" style="width: 80%;"></a>
          <!--logo end-->
          <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
			
			<!-- inbox dropdown start-->
                    <li id="header_inbox_bar" class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <i class="icon-envelope-alt"></i>
                            <span class="badge bg-important">5</span>
                        </a>
                        <ul class="dropdown-menu extended inbox">
                            <div class="notify-arrow notify-arrow-red"></div>
                            <li>
                                <p class="red">Tienes 5 pedidos de intercambio</p>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="photo"><img alt="avatar" src="./images/avatar-mini.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Juan Carlos Jacobs</span>
                                    
                                    </span>
                                    <span class="message">
                                        Galaxy GT890 <---> Moto G
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="photo"><img alt="avatar" src="./images/avatar-mini2.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Uriel Mr.Worldwide Mysler</span>
                                    
                                    </span>
                                    <span class="message">
                                     Camion de juguete <---> Autito Mattel 
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="photo"><img alt="avatar" src="./images/avatar-mini3.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Jonathan Washington Corallo</span>
                                   
                                    </span>
                                    <span class="message">
                                        Arroz con leche <---> Nieve Nevada '07 
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="photo"><img alt="avatar" src="./images/avatar-mini4.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Federico Alejandro Casares</span>
                                    
                                    </span>
                                    <span class="message">
                                        Taza dia del padre <---> Cartas Pokemon
                                    </span>
                                </a>
                            </li>
							<li>
                                <a href="#">
                                    <span class="photo"><img alt="avatar" src="./images/avatar-mini.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Juan Carlos Jacobs</span>
                                    
                                    </span>
                                    <span class="message">
                                        Star Wars Empaque original <---> Guión original LOTR
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#">See all messages</a>
                            </li>
                        </ul>
                    </li>
                    <!-- inbox dropdown end -->
             
          </ul>
          </div>
          <div class="top-nav ">
              <ul class="nav pull-right top-menu">
                  
                  <!-- user login dropdown start-->
                  <li class="dropdown">
                      <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                          <img id="profile_photo" alt="" src="images/avatar-default.png">
                          <span id="profile_name" class="username">Cargando</span>
                          <b class="caret"></b>
                      </a>
                      <ul class="dropdown-menu extended logout">
                          <div class="log-arrow-up"></div>
                          <li><a href="#"><i class=" icon-suitcase"></i>Perfil</a></li>
                          <li><a href="addItem.html"><i class="icon-plus"></i> Agregar Item</a></li>
                          <li><a href="#"><i class="icon-bell-alt"></i> Solicitudes</a></li>
                          <li><a href="javascript:logout();"><i class="icon-key"></i> Log Out</a></li>
                      </ul>
                  </li>
                  <!-- user login dropdown end -->
              </ul>
          </div>
      </header>
      <!--header end-->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
                  <li>
                      <a href="index.html">
                          <i class="icon-home"></i>
                          <span>P&aacute;gina Principal</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="profile.html">
                          <i class="icon-list"></i>
                          <span>Mis Items</span>
                      </a>
                  </li>

				  <li>
                      <a href="#">
                          <i class="icon-glass"></i>
                          <span>Solicitudes de Intercambio</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="#">
                          <i class="icon-shopping-cart"></i>
                          <span>Mis Solicitudes</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="#">
                          <i class="icon-book"></i>
                          <span>Historial de Intercambios</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="friends.html">
                          <i class="icon-user"></i>
                          <span>Amigos</span>
                      </a>
                  </li>
				</ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      <!--main content start-->
      <section id="main-content">
	  
          <section class="wrapper site-min-height">
              <!-- page start-->
              <div class="row">
                  <aside class="profile-nav col-lg-3">
                      <section class="panel">
                          <div class="user-heading round">
                              <a href="#">
                                  <img id="profile_photo2" src="images/avatar-default.png" alt="">
                              </a>
                              <h1 id="profile_name2">Cargando...</h1>
                              <p></p>
                          </div>

                          <ul class="nav nav-pills nav-stacked" id="profile-navigator">
                              <li class="active"><a href="profile.html"> <i class="icon-user"></i> Profile</a></li>
                              <li><a href="#"> <i class="icon-calendar"></i> Historial de Ventas <span class="label label-danger pull-right r-activity"></span></a></li>
                              <li><a href="addItem.html"> <i class="icon-edit"></i> Agregar Item</a></li>
                          </ul>

                      </section>
                  </aside>
                  <aside class="profile-info col-lg-9">
                     <section class="panel" id="panel">
                          <div class="bio-graph-heading">
                              Mis Items
                          </div>
                          <div class="row product-list" style="margin:20px;" id="itemList">
							  
						  </div>
                      </section>
                     
                  </aside>
              </div>
	<!-- modal start -->
	  <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="cargandoModal" class="modal fade" style="display: none;">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                          <h4 class="modal-title">Cargando...</h4>
                      </div>
                      <div class="modal-body">
                          <img src="http://w1.hoyennoticias.com.ve//wp-content/themes/HEN/images/loading.gif" style="width:40px;margin-left:45%">

                      </div>
                  </div>
              </div>
          </div>
		  <!-- modal ends -->
		  	<!-- modal start -->
			<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="offeredItemModal" class="modal fade" style="display: none;">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                          <h4 class="modal-title">Elige un item de tu inventario</h4>
                      </div>
                      <div class="modal-body">
                   <section class="panel" style="overflow: auto;overflow-y: scroll;height: 300px;">
                  <header class="panel-heading">
                      Inventario
                  </header>
                  <div class="panel-body">
                      <table class="table table-hover file-search">
                          <thead>
                          <tr>
                              <th style="width: 60%;">Título</th>
                              <th class="hidden-phone">Creado</th>
                              <th class="hidden-phone"></th>
                          </tr>
                          </thead>
                          <tbody id="modalItemList">
                          

                          </tbody>
                      </table>

                      
                  </div>
              </section>

                      </div>
                  </div>
              </div>
          </div>
		  <!-- modal ends -->
		  <!-- modal start -->
			<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="showItemModal" class="modal fade" style="display: none;">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                          <h4 class="modal-title">Información del Item</h4>
                      </div>
                      <div class="modal-body">
                              <!--widget start-->
                              <section class="panel">
                                  <div class="twt-feed blue-bg">
                                      <h1 id="showItemTitulo" >Celular Liberado Mini S3 Android 4 Dualsim Wifi Tv Bluetooth</h1>
                                      <p></p>
                                      <a href="#">
                                          <img id="showItemImagen" src="http://mla-s2-p.mlstatic.com/13227-MLA20074014007_042014-O.jpg" alt="">
                                      </a>
                                  </div>
                                  <div class="weather-category twt-category">
                                      <ul>
                                          <li class="active pull-left" >
                                              <h5 id="showItemFecha">12-03-14</h5>
                                              Fecha de Creación
                                          </li>
                                          <li>
                                              <a id="showItemLink" class="btn btn-info" href="javascript:solicitarTrade(id);">
                                          
                                          Solicitar Trade
                                      </a>
                                          </li>
                                          <li>
                                              
                                          </li>
                                      </ul>
                                  </div>
                              </section>
                              <!--widget end-->
                          
						  </div>
                  </div>
              </div>
          </div>
		  <!-- modal ends -->
		  
              <!-- page end-->
          </section>
      </section>
      <!--main content end-->
      <!--footer start-->
      <footer class="site-footer">
          <div class="text-center">
              2014 &copy; TruequeLibre.
              <a href="#" class="go-top">
                  <i class="icon-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="js/jquery.scrollTo.min.js"></script>
    <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
    <!--<script src="assets/jquery-knob/js/jquery.knob.js"></script>-->
    <script src="js/respond.min.js" ></script>
	<script type="text/javascript" src="assets/gritter/js/jquery.gritter.js"></script>
    <!--common script for all pages-->
    <script src="js/common-scripts.js"></script>


	<script>
		function getItems(uid){
		
		$.getJSON('/api/users/'+uid+'/items', function (data) {
				console.log(data);
				var itemBoxSize;
				if( isMobile.any() ) {
					if(window.innerHeight > window.innerWidth){
						itemBoxSize= ($('#panel').width()-30);
					}else{
						itemBoxSize= ($('#panel').width()-80)/4;
					}
				}else{
				   itemBoxSize= ($('#panel').width()-80)/4;
				}
				
				$('#itemList').empty();
				data.items.forEach(function(item){
					$('#itemList').append('<div class="col-md-3"><section class="panel"> \
					<div class="pro-img-box" style="width: '+itemBoxSize+'px;height: '+itemBoxSize+'px;text-align: center;"> \
					<img id="'+item.itemId+'" src="'+item.img+'" alt="" style="width: auto;height: '+itemBoxSize+'px;max-width: '+itemBoxSize+'px;"/> \
					<a href="javascript:showItemModal('+item.itemId+','+uid+')" class="adtocart"><i class="icon-search"></i></a></div> \
					<div class="panel-body text-center"><h4><a id="'+item.itemId+'" href="#" class="pro-title max-lines-2">'+item.name+'</a></h4><p class="price"> \
					</p></div></section></div>');
				});
                $('#cargandoModal').modal('hide');
        })
	}
	
	function showItemModal(itemId,uid){
		$('#cargandoModal').modal('show');
		$.getJSON('/api/users/'+uid+'/items/'+itemId, function (data) {
				console.log(data);
				$('#showItemTitulo').html(data.name);
				$('#showItemImagen').attr("src",data.img);
				$('#showItemFecha').html(timeConverter(data.dateCreated));
				if(friendId==null || friendId==userId){
					//share on Fb
					$('#showItemLink').html('<i class="icon-facebook"></i> Compartir')
					$('#showItemLink').attr('href',"javascript:shareOnFb("+data.itemId+");")
					$('#showItemModal').find("li").eq( 2 ).html('<a class="btn btn-danger" href="javascript:eliminarItem('+data.itemId+')"> Eliminar</a>');
				}else{
					$('#showItemLink').html('Solicitar Trade')
					$('#showItemLink').attr('href',"javascript:elegirOfferedItem("+data.itemId+");");
					$('#showItemModal').find("li").eq( 2 ).html();
				}
				$('#cargandoModal').modal('hide');
				$('#showItemModal').modal('show');
		});
	}
	function elegirOfferedItem(itemId){
		$('#showItemModal').modal('hide');
		$('#cargandoModal').modal('show');
		$.getJSON('/api/users/'+userId+'/items', function (data) {
				console.log(data);
				$('#modalItemList').empty();
				data.items.forEach(function(item){
					$('#modalItemList').append('<tr> \
                              <td> \
                                  <img alt="" src="'+item.img+'" style="width:30px"> \
                                  <strong style="overflow:hidden">'+item.name+'</strong>\
                              </td> \
                              <td class="hidden-phone">'+timeConverter(item.dateCreated)+'</td> \
                              <td class="hidden-phone"><a class="btn btn-info" href="javascript:solicitarTrade('+item.itemId+','+itemId+')">Elegir</a></td> \
                          </tr>');
				});
				$('#cargandoModal').modal('hide');
				$('#offeredItemModal').modal('show');
		});
	}
	var friendId=null;
	
	function solicitarTrade(offeredItem,wantedItem){
	$('#offeredItemModal').modal('hide');
		$('#cargandoModal').modal('show');
		$.post( "/api/users/"+friendId+"/items/"+wantedItem, { offeredItemId: offeredItem }, function( data ) {
		  console.log( data ); 
			$('#cargandoModal').modal('hide');
			
			$.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Solicitud Enviada',
            // (string | mandatory) the text inside the notification
            text: 'Se ha enviado una solicitud al item xxx por el item yyy.',
            // (string | optional) the image to display on the left
            image: 'http://graph.facebook.com/'+friendId+'/picture?type=small',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: true,
            // (int | optional) the time you want it to be alive for before fading out
            time: ''
			});
		}, "json");
	}
	
	function eliminarItem(itemId){
		if(confirm("¿Estas seguro de eliminar el item?")){
			$('#showItemModal').modal('hide');
			$('#cargandoModal').modal('show');
			$.ajax({
				url: "/api/users/"+userId+"/items/"+itemId,
				type: 'DELETE',
				dataType: 'json',
				data: '',
				success: function( data ) {
							  console.log( data ); 
								$('#cargandoModal').modal('hide');
								$.gritter.add({
								// (string | mandatory) the heading of the notification
								title: '¡Item eliminado con éxito!',
								// (string | mandatory) the text inside the notification
								text: 'Se ha eliminado el item seleccionado.',
								// (string | optional) the image to display on the left
								image: 'http://graph.facebook.com/'+userId+'/picture?type=small',
								// (bool | optional) if you want it to fade out on its own or just sit there
								sticky: true,
								// (int | optional) the time you want it to be alive for before fading out
								time: ''
								});
								getItems(userId);
						}
			});	
		}
	}
	
	
      $(document).ready(function() {
	  debugger;
	  $('#cargandoModal').modal('show');
 	  fbEnsureInit( function(response) {
		
			var uid=null;
			if(getUrlParameter('id')!=null){
				uid=getUrlParameter('id');
				friendId=uid;
				$('ul.nav-pills').find('li').eq(2).empty();
				$('ul.nav-pills').find('li').eq(1).empty();
			}else{
				uid=userId;
			}
				
			$.getJSON('/api/users/'+uid, function (data) {
				console.log(data);
				document.getElementById('profile_name2').innerHTML = data.name;
				document.getElementById('profile_photo2').setAttribute('src', data.profilePic);
				getItems(uid);
                //$('#cargandoModal').modal('toggle');
			})
			
			if(getUrlParameter('item')!=null){
				showItemModal(getUrlParameter('item'),uid)
			}
		
		}); 
         
      });
		</script>


  </body>
</html>
