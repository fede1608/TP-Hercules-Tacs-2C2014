<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Hercules">
    <meta name="keyword" content="Truequelibre">
    <link rel="shortcut icon" href="img/favicon.png">

    <title>Solicitudes de Intercambio</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
	<script src="js/truequelibre/truequelibre.js" type="text/javascript"></script>  
  <section id="container" class="">
      <!--header start-->
      <header class="header white-bg">
          <div class="sidebar-toggle-box">
              <div data-original-title="Toggle Navigation" data-placement="right" class="icon-reorder tooltips"></div>
          </div>
          <!--logo start-->
          <a href="index.html" class="logo" ><img src="images/logo-truequelibre.png" style="width: 80%;"></a>
          <!--logo end-->
          <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
			
			<!-- inbox dropdown start-->
                    <li id="header_inbox_bar" class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <i class="icon-envelope-alt"></i>
                            <span class="badge bg-important"></span>
                        </a>
                        <ul class="dropdown-menu extended inbox">
                            <div class="notify-arrow notify-arrow-red"></div>
                            <li>
                                <p class="red">Tienes 0 pedidos de intercambio</p>
                            </li>
                            
                            <li>
                                <a href="#">See all messages</a>
                            </li>
                        </ul>
                    </li>
                    <!-- inbox dropdown end -->
             
          </ul>
          </div>
          <div class="top-nav ">
              <ul class="nav pull-right top-menu">
                  <!-- user login dropdown start-->
                  <li class="dropdown">
                      <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                          <img id="profile_photo" alt="" src="image/avatar-default.png">
                          <span id="profile_name" class="username">Cargando</span>
                          <b class="caret"></b>
                      </a>
                      <ul class="dropdown-menu extended logout">
                          <div class="log-arrow-up"></div>
                          <li><a href="profile.html"><i class=" icon-suitcase"></i>Perfil</a></li>
                          <li><a href="addItem.html"><i class="icon-plus"></i> Agregar Item</a></li>
                          <li><a href="#"><i class="icon-bell-alt"></i> Solicitudes</a></li>
                          <li><a href="javascript:logout();"><i class="icon-key"></i> Log Out</a></li>
                      </ul>
                  </li>
                  <!-- user login dropdown end -->
              </ul>
          </div>
      </header>
      <!--header end-->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
                  <li>
                      <a href="index.html">
                          <i class="icon-home"></i>
                          <span>P&aacute;gina Principal</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="profile.html">
                          <i class="icon-list"></i>
                          <span>Mis Items</span>
                      </a>
                  </li>

				  <li>
                      <a href="#">
                          <i class="icon-glass"></i>
                          <span>Solicitudes de Intercambio</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="#">
                          <i class="icon-shopping-cart"></i>
                          <span>Mis Solicitudes</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="historial.html">
                          <i class="icon-book"></i>
                          <span>Historial de Intercambios</span>
                      </a>
                  </li>
				  
				  <li>
                      <a href="friends.html">
                          <i class="icon-user"></i>
                          <span>Amigos</span>
                      </a>
                  </li>
				</ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper site-min-height">
              <div class="row">
                  
                  <aside class="profile-info col-lg-12">
                      <section class="panel" id="panel" style="background-color: lightgray;">
                          <div class="bio-graph-heading">
                              Mis solicitudes de trueque.
                          </div>
                          
                          						  <section class="panel">
                          <header class="panel-heading tab-bg-dark-navy-blue">
                              <ul class="nav nav-tabs">
                                  
                                  <li class="active">
                                      <a data-toggle="tab" href="#about-2">
                                          <i class="icon-user"></i>
                                          Solicitudes enviadas
                                      </a>
                                  </li>
                                  <li class="">
                                      <a data-toggle="tab" href="#contact-2">
                                          <i class="icon-envelope"></i>
                                          Solicitudes recibidas
                                      </a>
                                  </li>
                              </ul>
                          </header>
                          <div class="panel-body">
                              <div class="tab-content">
                                  
                                  <div id="about-2" class="tab-pane active">
									<section class="panel">
									  <header class="panel-heading">
										  Trueques
										  <span class="tools pull-right">
											<!-- <a class="icon-chevron-down" href="javascript:;"></a>
											<a class="icon-remove" href="javascript:;"></a> -->
										</span>
									  </header>
									  <div class="panel-body">
										<div class="timeline-messages" id="tradeList">
										</div>
									</div>
									</section>
								  </div>
                                  <div id="contact-2" class="tab-pane">
									<section class="panel">
									  <header class="panel-heading">
										  Trueques
										  <span class="tools pull-right">
											<!-- <a class="icon-chevron-down" href="javascript:;"></a>
											<a class="icon-remove" href="javascript:;"></a> -->
										</span>
									  </header>
									  <div class="panel-body">
										<div class="timeline-messages" id="tradeList2">
										</div>
									</div>
									</section>
								  </div>
                              </div>
                          </div>
                      </section>
                          
                          
                      </section>
                  </aside>
              </div>
         
         
         
     <!--    <section class="panel">
          <div class="row" style="margin:20px;" id="tradesList">
		  						  
		  </div>
		</section>-->
          </section>



		
		
		
      </section>
      <!--main content end-->
      <!--footer start-->
      <footer class="site-footer">
          <div class="text-center">
              2014 &copy; TruequeLibre
              <a href="#" class="go-top">
                  <i class="icon-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>
<!-- modal start -->
	  <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="cargandoModal" class="modal fade" style="display: none;">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                          <h4 class="modal-title">Cargando...</h4>
                      </div>
                      <div class="modal-body">
                          <img src="http://w1.hoyennoticias.com.ve//wp-content/themes/HEN/images/loading.gif" style="width:40px;margin-left:45%">

                      </div>
                  </div>
              </div>
          </div>
		  <!-- modal ends -->
      <!--main content end-->
    <!-- js placed at the end of the document so the pages load faster -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="js/jquery.scrollTo.min.js"></script>
    <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="js/respond.min.js" ></script>

    <!--common script for all pages-->
    <script src="js/common-scripts.js"></script>
<script>
		function getPendingTrades(){
debugger;		
		$.getJSON('/api/pendingTrades', function (data) {
				console.log(data);

				$('#tradeList').empty();
				var requestNumber=0;

				data.sentTradeRequests.forEach(function(trade){
					requestNumber++;
					$('#tradeList').append(
							
							'<!-- Trade start -->'+
							'<section class="panel" id='+trade.id+'>'+
							
							'<header class="panel-heading">'+
	                            'Solicitud de trueque #'+requestNumber+
                       		'</header>'+
							  '<div class="col-lg-12">'+
			                      '<!--offered product info start-->'+
			                      '<section class="panel post-wrap pro-box">'+
			                          '<aside>'+
			                              '<div class="post-info">'+
			                                  '<span class="arrow-pro right"></span>'+
			                                  '<div class="panel-body">'+
			                                      '<h1><strong>oferta realizada</strong> <br> has ofrecido un trueque a '+trade.wantedItem.ownerName+'</h1>'+
			                                      '<div class="desk yellow">'+
			                                          '<h3>'+trade.offeredItem.name+'</h3>'+
			                                      '</div>'+
			                                     
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                          '<aside class="post-highlight yellow v-align">'+
			                              '<div class="panel-body text-center">'+
			                                  '<div class="pro-thumb">'+
			                                      '<img src=' + trade.offeredItem.img + 'alt="">'+
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                      '</section>'+
			                      '<!--offered product info end-->'+
			                      
			                      
			                      '<!--wanted product info start-->'+
			                      '<section class="panel post-wrap pro-box">'+
			                          '<aside class="post-highlight yellow v-align">'+
			                              '<div class="panel-body text-center">'+
			                                  '<div class="pro-thumb">'+
			                                      '<img src=' + trade.wantedItem.img + 'alt="">'+
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                          '<aside>'+
			                              '<div class="post-info">'+
			                                  '<span class="arrow-pro left"></span>'+
			                                  '<div class="panel-body">'+
			                                      '<h1><strong>Quieres este ítem</strong> <br> Espera la respuesta de '+trade.wantedItem.ownerName+'.</h1>'+
			                                      '<div class="desk yellow">'+
			                                          '<h3>'+trade.wantedItem.name+'</h3>'+			                                      
			                                      '</div>'+
			                                      
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                      '</section>'+
			                      '<!--wanted product info end-->'+
			                  '</div>'+
			                  '<div class="row">'+
			                  	  '<div class="col-md-10"></div>'+
				                  '<a href="javascript:rejectTrade(\''+trade.id+'\')" type="button" class="btn btn-round btn-danger">Cancelar</button>'+
			                  '</div>'+
			                  
			                '</section>'+
							'<!-- Trade end   -->'	
							
							)
			  			});
                
                $('#tradeList2').empty();
				requestNumber=0;

				data.receivedTradeRequests.forEach(function(trade){
					requestNumber++;
					$('#tradeList2').append(
							
							'<!-- Trade start -->'+
							'<section class="panel" id='+trade.id+'>'+
							
							'<header class="panel-heading">'+
	                            'Solicitud de trueque #'+requestNumber+
                       		'</header>'+
							  '<div class="col-lg-12">'+
			                      '<!--offered product info start-->'+
			                      '<section class="panel post-wrap pro-box">'+
			                          '<aside>'+
			                              '<div class="post-info">'+
			                                  '<span class="arrow-pro right"></span>'+
			                                  '<div class="panel-body">'+
			                                      '<h1><strong>Nueva oferta</strong> <br> '+trade.offeredItem.ownerName+' te ha ofrecido un trueque</h1>'+
			                                      '<div class="desk yellow">'+
			                                          '<h3>'+trade.offeredItem.name+'</h3>'+
			                                      '</div>'+
			                                      
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                          '<aside class="post-highlight yellow v-align">'+
			                              '<div class="panel-body text-center">'+
			                                  '<div class="pro-thumb">'+
			                                      '<img src=' + trade.offeredItem.img + 'alt="">'+
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                      '</section>'+
			                      '<!--offered product info end-->'+
			                      
			                      
			                      '<!--offered product info start-->'+
			                      '<section class="panel post-wrap pro-box">'+
			                          '<aside class="post-highlight yellow v-align">'+
			                              '<div class="panel-body text-center">'+
			                                  '<div class="pro-thumb">'+
			                                      '<img src=' + trade.wantedItem.img + 'alt="">'+
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                          '<aside>'+
			                              '<div class="post-info">'+
			                                  '<span class="arrow-pro right"></span>'+
			                                  '<div class="panel-body">'+
			                                      '<h1><strong>Quieren este ítem</strong> <br> ¿Qué te parece, '+trade.wantedItem.ownerName +'?</h1>'+
			                                      '<div class="desk yellow">'+
			                                          '<h3>'+trade.wantedItem.name+'</h3>'+			                                      
			                                      '</div>'+
			                                      
			                                  '</div>'+
			                              '</div>'+
			                          '</aside>'+
			                      '</section>'+
			                      '<!--offered product info end-->'+
			                  '</div>'+
			                  '<div class="row">'+
			                  	  '<div class="col-md-10"></div>'+
				                  '<a href="javascript:acceptTrade(\''+trade.id+'\')" type="button" class="btn btn-round btn-success" a href="#">Aceptar</button>'+
				                  '<a href="javascript:rejectTrade(\''+trade.id+'\')" type="button" class="btn btn-round btn-danger">Rechazar</button>'+
			                  '</div>'+
			                  
			                '</section>'+
							'<!-- Trade end   -->'	
							
							)
			  			});
                
                $('#cargandoModal').modal('toggle');
                
                
        })
	}
		
		function acceptTrade(id)
		{
			$('#cargandoModal').modal('show');
			/*$.post( "api/pendingTrades/"+id", { itemId: id }, function( data ) {
			  console.log( data ); 
				$('#cargandoModal').modal('hide');
				
			}*/
		}
		function rejectTrade(id)
		{
			$('#cargandoModal').modal('show');
			$.ajax( 
					"api/pendingTrades/"+id, 
					{ type:'DELETE', 
						
					  success: function( data,statusCode, jqXHR ) {
								  console.log( data ); 
								  $('#'+id).remove();
									$('#cargandoModal').modal('hide');
								},
					 error: function( jqXHR,textStatus, message ) {
						  console.log( 'status: '+textStatus+" message: "+message ); 
							$('#cargandoModal').modal('hide');
							alert(message);
						}
					});
			
		}
	
	
      $(document).ready(function() {
		  debugger;
		  $('#cargandoModal').modal('toggle');
		  getPendingTrades();
         
      });
		</script>

  </body>
</html>
